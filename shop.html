<!-- âœ¨ ìŠ¤ë§ˆíŠ¸í° ëŒ€ì‘ ì£¼ë¬¸ ëª¨ë‹¬ -->
<style>
  #orderModal {
    display: none;
    position: fixed;
    z-index: 9999;
    top: 0; left: 0;
    width: 100%;
    height: 100vh;
    background: rgba(0, 0, 0, 0.85);
    justify-content: center;
    align-items: center;
  }
  .order-popup {
    background: #222;
    color: #eee;
    padding: 2rem;
    border-radius: 16px;
    max-width: 90%;
    width: 400px;
    text-align: left;
    box-sizing: border-box;
    font-family: 'Segoe UI', sans-serif;
  }
  .order-popup input {
    width: 100%;
    margin-top: 4px;
    margin-bottom: 16px;
    padding: 10px;
    border: none;
    border-radius: 8px;
    background: #333;
    color: #fff;
    font-size: 1rem;
  }
  .order-popup label {
    font-size: 0.95rem;
    display: block;
    margin-bottom: 4px;
  }
  .order-popup .btn {
    padding: 10px 16px;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    font-size: 1rem;
    margin-right: 8px;
    margin-top: 10px;
    cursor: pointer;
  }
  .copy-btn {
    background: #00cc99;
    color: #111;
  }
  .submit-btn {
    background: #00ccff;
    color: #111;
  }
  .cancel-btn {
    background: #444;
    color: #fff;
  }
</style>

<div id="orderModal">
  <div class="order-popup">
    <h2 style="color:#00ccff;">ğŸ›’ NFT ì¿ í° ì£¼ë¬¸</h2>
    <p><strong>ì„ íƒí•œ ì¿ í°:</strong> <span id="selectedCoupon"></span></p>
    <label>ìˆ˜ëŸ‰</label>
    <input type="number" id="orderQty" min="1" max="10" value="1" />

    <label>ì´ë¦„</label>
    <input type="text" id="orderName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" />

    <label>ì „í™”ë²ˆí˜¸</label>
    <input type="text" id="orderPhone" placeholder="01012345678" />

    <label>íŒ¬í…€ ì§€ê°‘ ì£¼ì†Œ (í´ë¦¬ê³¤)</label>
    <input type="text" id="orderWallet" placeholder="ì§€ê°‘ ì£¼ì†Œ ì…ë ¥" />

    <label>ğŸª™ íŒë§¤ì ì†”ë¼ë‚˜ ì£¼ì†Œ</label>
    <div style="display:flex; gap:8px;">
      <input type="text" id="sellerAddress" value="0xYourSolanaAddressHere" readonly />
      <button onclick="copySolanaAddress()" class="btn copy-btn">ğŸ“‹</button>
    </div>
    <p style="font-size:0.85rem; color:#aaa;">ìœ„ ì£¼ì†Œë¡œ ORCX í† í°ì„ ì „ì†¡í•´ì£¼ì„¸ìš”.</p>

    <button onclick="submitOrder()" class="btn submit-btn">âœ… ì£¼ë¬¸ ì™„ë£Œ</button>
    <button onclick="closeModal()" class="btn cancel-btn">âŒ ë‹«ê¸°</button>
  </div>
</div>

<script>
let selectedCoupon = "";

function openOrderForm(couponType) {
  selectedCoupon = couponType;
  document.getElementById("selectedCoupon").innerText = couponType;
  document.getElementById("orderModal").style.display = "flex";
  document.body.style.overflow = "hidden"; // ëª¨ë°”ì¼ ìŠ¤í¬ë¡¤ ë°©ì§€
}

function closeModal() {
  document.getElementById("orderModal").style.display = "none";
  document.body.style.overflow = "auto";
}

function copySolanaAddress() {
  const addr = document.getElementById("sellerAddress").value;
  navigator.clipboard.writeText(addr).then(() => {
    alert("ì†”ë¼ë‚˜ ì§€ê°‘ ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
  });
}

async function submitOrder() {
  const order = {
    couponType: selectedCoupon,
    qty: parseInt(document.getElementById("orderQty").value),
    name: document.getElementById("orderName").value.trim(),
    phone: document.getElementById("orderPhone").value.trim(),
    wallet: document.getElementById("orderWallet").value.trim()
  };

  if (!order.name || !order.phone || !order.wallet || order.qty < 1) {
    alert("ëª¨ë“  í•­ëª©ì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    return;
  }

  try {
    const res = await fetch("/api/buy-nft", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(order)
    });

    const result = await res.json();
    if (result.success) {
      alert("âœ… ì£¼ë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!\nì§€ê°‘ ì£¼ì†Œë¡œ í† í°ì„ ë³´ë‚´ì£¼ì„¸ìš”.");
      closeModal();
    } else {
      alert("âŒ ì£¼ë¬¸ ì‹¤íŒ¨: " + result.message);
    }
  } catch (err) {
    alert("ğŸš¨ ì„œë²„ ì˜¤ë¥˜ ë°œìƒ: " + err.message);
  }
}
</script>


