<!-- ✨ 스마트폰 대응 주문 모달 -->
<style>
  #orderModal {
    display: none;
    position: fixed;
    z-index: 9999;
    top: 0; left: 0;
    width: 100%;
    height: 100vh;
    background: rgba(0, 0, 0, 0.85);
    justify-content: center;
    align-items: center;
  }
  .order-popup {
    background: #222;
    color: #eee;
    padding: 2rem;
    border-radius: 16px;
    max-width: 90%;
    width: 400px;
    text-align: left;
    box-sizing: border-box;
    font-family: 'Segoe UI', sans-serif;
  }
  .order-popup input {
    width: 100%;
    margin-top: 4px;
    margin-bottom: 16px;
    padding: 10px;
    border: none;
    border-radius: 8px;
    background: #333;
    color: #fff;
    font-size: 1rem;
  }
  .order-popup label {
    font-size: 0.95rem;
    display: block;
    margin-bottom: 4px;
  }
  .order-popup .btn {
    padding: 10px 16px;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    font-size: 1rem;
    margin-right: 8px;
    margin-top: 10px;
    cursor: pointer;
  }
  .copy-btn {
    background: #00cc99;
    color: #111;
  }
  .submit-btn {
    background: #00ccff;
    color: #111;
  }
  .cancel-btn {
    background: #444;
    color: #fff;
  }
</style>

<div id="orderModal">
  <div class="order-popup">
    <h2 style="color:#00ccff;">🛒 NFT 쿠폰 주문</h2>
    <p><strong>선택한 쿠폰:</strong> <span id="selectedCoupon"></span></p>
    <label>수량</label>
    <input type="number" id="orderQty" min="1" max="10" value="1" />

    <label>이름</label>
    <input type="text" id="orderName" placeholder="이름을 입력하세요" />

    <label>전화번호</label>
    <input type="text" id="orderPhone" placeholder="01012345678" />

    <label>팬텀 지갑 주소 (폴리곤)</label>
    <input type="text" id="orderWallet" placeholder="지갑 주소 입력" />

    <label>🪙 판매자 솔라나 주소</label>
    <div style="display:flex; gap:8px;">
      <input type="text" id="sellerAddress" value="0xYourSolanaAddressHere" readonly />
      <button onclick="copySolanaAddress()" class="btn copy-btn">📋</button>
    </div>
    <p style="font-size:0.85rem; color:#aaa;">위 주소로 ORCX 토큰을 전송해주세요.</p>

    <button onclick="submitOrder()" class="btn submit-btn">✅ 주문 완료</button>
    <button onclick="closeModal()" class="btn cancel-btn">❌ 닫기</button>
  </div>
</div>

<script>
let selectedCoupon = "";

function openOrderForm(couponType) {
  selectedCoupon = couponType;
  document.getElementById("selectedCoupon").innerText = couponType;
  document.getElementById("orderModal").style.display = "flex";
  document.body.style.overflow = "hidden"; // 모바일 스크롤 방지
}

function closeModal() {
  document.getElementById("orderModal").style.display = "none";
  document.body.style.overflow = "auto";
}

function copySolanaAddress() {
  const addr = document.getElementById("sellerAddress").value;
  navigator.clipboard.writeText(addr).then(() => {
    alert("솔라나 지갑 주소가 복사되었습니다!");
  });
}

async function submitOrder() {
  const order = {
    couponType: selectedCoupon,
    qty: parseInt(document.getElementById("orderQty").value),
    name: document.getElementById("orderName").value.trim(),
    phone: document.getElementById("orderPhone").value.trim(),
    wallet: document.getElementById("orderWallet").value.trim()
  };

  if (!order.name || !order.phone || !order.wallet || order.qty < 1) {
    alert("모든 항목을 정확히 입력해주세요.");
    return;
  }

  try {
    const res = await fetch("/api/buy-nft", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(order)
    });

    const result = await res.json();
    if (result.success) {
      alert("✅ 주문이 성공적으로 접수되었습니다!\n지갑 주소로 토큰을 보내주세요.");
      closeModal();
    } else {
      alert("❌ 주문 실패: " + result.message);
    }
  } catch (err) {
    alert("🚨 서버 오류 발생: " + err.message);
  }
}
</script>


